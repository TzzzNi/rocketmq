## 核心概念（Core Concept）


![cmd-markdown-logo](https://jc-zy.oss-cn-shanghai.aliyuncs.com/Screen%20Shot%202018-08-20%20at%209.47.32%20PM.png)

根据上述模型，我们可以深入研究以下有关消息传递系统设计的话题：

- 消费并发
- 消费热点
- 消费均衡
- 消息路由
- 多种链接方式
- 金丝雀部署

## 生产者 Producer

生产者将业务中产生的消息发送到broker，rocketMQ为其提供了多种发送方式：同步，异步以及单程。


### 生产者组 Producer Group

生产者组由同一角色的生产者构成。同一生产者组的不同生产实例，可以通过broker提交或回滚事务，以防原始的生产者在开始交易后坠毁联系。

**警告** ：考虑到生产者消息发送能力很强，每个生产者组只允许有一个实例用来避免不必要的初始化。

```
RocketMQ中的生产者组只能有一个在用的生产者：用来表示一个发送消息应用，一个生产者组下包含多个生产者实例，可以是多台机器，也可以是一台机器的多个进程，或者一个进程的多个生产者对象。
```

## 消费者 Consumer

消费者负责从broker拉取消息，然后返还给应用。从用户应用的角度来看，RocketMQ提供了两种类型的消费者：


### 拉取型消费者

拉取型主动从broker拉取信息，一旦信息被拉取，应用则启动消费进程。


### 推送型消费者

推送型是另一种思路，它封装了消息的拉取和消费进程和其他的内部工作细节，只提供一个在消息到达时的回调接口。



### 消费者组 Consumer Group

与生产者组类似，相同的消费者角色构成消费者组。消费者组实现了负载平衡和容错，对于信息消费十分便捷实用。

**警告**：消费者是消费者组中的一个实例，必须订阅相同的主题。


## 主题 Topic

主题是生产者传递消息和消费者拉取消息的类别。主题与生产者、消费者之间是松耦合的关系。特别强调，一个主题可以有零个、一个或者多个生产者向它发送消息。相反，一个生产者可以向多个不同的主题发送消息。从消费者角度讲，一个主题可以被零个、一个或者多个消费者组订阅，同样的，一个消费者组可以订阅一个或多个主题，只要这个消费者组保持一致的订阅即可。

## 消息 Message

消息是被用于传递的信息。消息必须有一个主题，这可以理解为你的邮寄地。消息也可以有一个标记集或者额外的键-值对。例如，你可以在发送一条消息时设置一个key，并通过这个key在broker中筛选这条消息，从而帮助诊断故障。

### 消息队列 Message Queue

主题被划分为一个或多个子主题，这就是消息队列。

```
无论生产者还是消费者，实际的生产和消费都是针对消费队列级别。例如生产者发送消息的时候，会预先选择（默认轮询）好该主题下面的某一条队列发送；消费者消费的时候也会负载均衡地分配若干个队列，只拉取对应队列的消息。

```

### 标签 Tag

标签可以理解为更细一级的主题，为使用者提供更灵活的查找。有了标签，同一业务产生的不同用途的消息，即便有相同的主题，也可以通过不同的标签区分。此外，标签可以让你的代码变得清晰连贯，并为RocketMQ的查询系统提供更好的支持。

### 代理 Broker

broker是RockerMQ系统的重要组成部分。它接受并存储生产者发送的消息，并处理来自消费者的拉取请求。它也存储和元数据有关的信息，包括消费者组，消费位置还有主题／队列的信息。

## 名称服务 Name Server
名称服务提供路由信息，为生产者和消费者提供相应的代理人列表，从而查找主题。

## 消息模式 Message Model

- 集群clustering
- 广播broadcasting

## 消息顺序 Message Order

当DefaultMQPushConsumer被设置好，你可能需要决定消费是顺序的还是并发的。

- 顺序
有序的消息意味着消息的使用顺序与生产者为每个消息队列发送的顺序相同。如果你的使用场景要求必须是顺序的，你要确保每个主题只有一个信息队列。

```
RocketMQ的顺序消息需要满足2点：生产者端保证发送消息有序，且发送到同一个队列；消费者端保证消费同一个队列。

```

  **警告**：如果消费顺序被指定，最大的信息并发数就是这个消费者组的消息队列的订阅数。

- 并发：
当并发消费消息时，最大的消息消费数只受限于每个消费客户端线程池规定的数。
  
   **警告**：这个模式下顺序不再被保证.
